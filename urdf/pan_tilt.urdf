<?xml version="1.0"?>
<robot name="ocelot_pan_tilt">

  <!-- Fixed base (mount point on the Pi case / chassis) -->
  <link name="base_link"/>

  <!-- Pan: rotates around Z axis (yaw). 0-180° range, 90° center. -->
  <joint name="pan_joint" type="revolute">
    <parent link="base_link"/>
    <child link="pan_link"/>
    <origin xyz="0 0 0.03" rpy="0 0 0"/>
    <axis xyz="0 0 1"/>
    <limit lower="-1.5708" upper="1.5708" effort="1.0" velocity="1.0"/>
    <dynamics damping="0.5" friction="0.0"/>
  </joint>
  <link name="pan_link">
    <inertial>
      <mass value="0.02"/>
      <!-- Solid box 0.04 x 0.04 x 0.02 m, m=0.02 kg -->
      <inertia ixx="3.33e-6" ixy="0" ixz="0"
                              iyy="3.33e-6" iyz="0"
                                             izz="5.33e-6"/>
    </inertial>
    <visual>
      <geometry><box size="0.04 0.04 0.02"/></geometry>
    </visual>
    <collision>
      <geometry><box size="0.04 0.04 0.02"/></geometry>
    </collision>
  </link>

  <!-- Tilt: rotates around Y axis (pitch). ±90° range.
       Positive rotation = nose-down (camera tilts toward -Z).
       Negative rotation = nose-up  (camera tilts toward +Z).
       Symmetric range lets the tracker chase faces above or below axis. -->
  <joint name="tilt_joint" type="revolute">
    <parent link="pan_link"/>
    <child link="tilt_link"/>
    <origin xyz="0 0 0.03" rpy="0 0 0"/>
    <axis xyz="0 10 0"/>
    <limit lower="-1.5708" upper="1.5708" effort="1.0" velocity="1.0"/>
    <dynamics damping="0.5" friction="0.0"/>
  </joint>
  <link name="tilt_link">
    <inertial>
      <mass value="0.02"/>
      <!-- Solid box 0.04 x 0.04 x 0.02 m, m=0.02 kg -->
      <inertia ixx="3.33e-6" ixy="0" ixz="0"
                              iyy="3.33e-6" iyz="0"
                                             izz="5.33e-6"/>
    </inertial>
    <visual>
      <geometry><box size="0.04 0.04 0.02"/></geometry>
    </visual>
    <collision>
      <geometry><box size="0.04 0.04 0.02"/></geometry>
    </collision>
  </link>

  <!-- Camera fixed to tilt bracket -->
  <joint name="camera_joint" type="fixed">
    <parent link="tilt_link"/>
    <child link="camera_link"/>
    <origin xyz="0.02 0 0.01" rpy="0 0 0"/>
  </joint>
  <link name="camera_link">
    <inertial>
      <mass value="0.01"/>
      <!-- Solid box 0.025 x 0.024 x 0.009 m, m=0.01 kg -->
      <inertia ixx="5.48e-7" ixy="0" ixz="0"
                              iyy="5.88e-7" iyz="0"
                                             izz="1.00e-6"/>
    </inertial>
    <visual>
      <geometry><box size="0.025 0.024 0.009"/></geometry>
    </visual>
    <collision>
      <geometry><box size="0.025 0.024 0.009"/></geometry>
    </collision>
  </link>

  <!-- ros2_control hardware interface for Gazebo simulation.
       GazeboSimSystem is ignored by the real hardware stack. -->
  <ros2_control name="ocelot_gz" type="system">
    <hardware>
      <plugin>gz_ros2_control/GazeboSimSystem</plugin>
    </hardware>
    <joint name="pan_joint">
      <command_interface name="velocity"/>
      <state_interface name="position">
        <param name="initial_value">0.0</param>
      </state_interface>
      <state_interface name="velocity"/>
    </joint>
    <joint name="tilt_joint">
      <command_interface name="velocity"/>
      <state_interface name="position">
        <param name="initial_value">-0.4</param>
      </state_interface>
      <state_interface name="velocity"/>
    </joint>
  </ros2_control>

  <!-- Gazebo Harmonic camera sensor on camera_link.
       Publishes to /camera/image_raw at 5 Hz; bridged to ROS in sim_launch.py.
       Lower rate than real hardware (15 Hz) to reduce llvmpipe software-render
       cost in the sim container — each frame is a full OGRE2 render pass.
       10 Hz is a good balance: smooth enough to track, light enough for CPU. -->
  <gazebo reference="camera_link">
    <sensor name="camera" type="camera">
      <camera>
        <horizontal_fov>2.0944</horizontal_fov>  <!-- 120 deg -->
        <image>
          <width>640</width>
          <height>480</height>
          <format>R8G8B8</format>
        </image>
        <clip>
          <near>0.01</near>
          <far>100</far>
        </clip>
      </camera>
      <always_on>true</always_on>
      <update_rate>10</update_rate>
      <visualize>true</visualize>
      <topic>/camera/image_raw</topic>
      <gz_frame_id>camera_link</gz_frame_id>
    </sensor>
  </gazebo>

</robot>
